<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>TCP (mirage-protocols.Mirage_protocols_lwt.TCP)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">mirage-protocols</a> &#x00BB; <a href="../index.html">Mirage_protocols_lwt</a> &#x00BB; TCP</nav><h1>Module type <code>Mirage_protocols_lwt.TCP</code></h1><p>Transmission Control Protocol layer: reliable ordered streaming communication.</p></header><dl><dt class="spec type" id="type-error#row"><a href="#type-error#row" class="anchor"></a><code><span class="keyword">type</span> error#row</code></dt><dd><p>The type for TCP errors.</p></dd></dl><dl><dt class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><code><span class="keyword">and</span> error</code> = <span class="keyword">private</span> <code>[&gt; </code><table class="variant"><tr id="type-error.Tcp.error" class="anchored"><td class="def type"><a href="#type-error.Tcp.error" class="anchor"></a><code>| </code><code><a href="../Tcp/index.html#type-error">Tcp.error</a></code></td></tr></table><code> ]</code></dt><dd><p>The type for TCP errors.</p></dd></dl><dl><dt class="spec type" id="type-write_error#row"><a href="#type-write_error#row" class="anchor"></a><code><span class="keyword">type</span> write_error#row</code></dt><dd><p>The type for TCP write errors.</p></dd></dl><dl><dt class="spec type" id="type-write_error"><a href="#type-write_error" class="anchor"></a><code><span class="keyword">and</span> write_error</code> = <span class="keyword">private</span> <code>[&gt; </code><table class="variant"><tr id="type-write_error.Tcp.write_error" class="anchored"><td class="def type"><a href="#type-write_error.Tcp.write_error" class="anchor"></a><code>| </code><code><a href="../Tcp/index.html#type-write_error">Tcp.write_error</a></code></td></tr></table><code> ]</code></dt><dd><p>The type for TCP write errors.</p></dd></dl><dl><dt class="spec type" id="type-ipaddr"><a href="#type-ipaddr" class="anchor"></a><code><span class="keyword">type</span> ipaddr</code></dt><dd><p>The type for IP address representations.</p></dd></dl><dl><dt class="spec type" id="type-ipinput"><a href="#type-ipinput" class="anchor"></a><code><span class="keyword">type</span> ipinput</code></dt><dd><p>The type for input function continuation to pass onto the underlying <a href="../module-type-IP/index.html"><code>IP</code></a> layer. This will normally be a NOOP for a conventional kernel, but a direct implementation will parse the buffer.</p></dd></dl><dl><dt class="spec type" id="type-flow"><a href="#type-flow" class="anchor"></a><code><span class="keyword">type</span> flow</code></dt><dd><p>A flow represents the state of a single TCPv4 stream that is connected to an endpoint.</p></dd></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> Mirage_device.S</code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt></dl><dl><dt class="spec value" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><code><span class="keyword">val</span> disconnect : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt></dl></details></div></div></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> Mirage_flow.S <span class="keyword">with</span> <span class="keyword">type</span> <a href="../index.html#module-type-TCP">TCP</a>.flow := <a href="index.html#type-flow">flow</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../index.html#module-type-TCP">TCP</a>.error := <a href="index.html#type-error">error</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../index.html#module-type-TCP">TCP</a>.write_error := <a href="index.html#type-write_error">write_error</a></code></span></summary><dl><dt class="spec value" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span class="keyword">val</span> pp_error : <span><a href="index.html#type-error">error</a> Fmt.t</span></code></dt><dt class="spec value" id="val-pp_write_error"><a href="#val-pp_write_error" class="anchor"></a><code><span class="keyword">val</span> pp_write_error : <span><a href="index.html#type-write_error">write_error</a> Fmt.t</span></code></dt><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <span><span><span>(<span>Cstruct.t Mirage_flow.or_eof</span>, <a href="index.html#type-error">error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> Cstruct.t <span>&#45;&gt;</span> <span><span><span>(unit, <a href="index.html#type-write_error">write_error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dt class="spec value" id="val-writev"><a href="#val-writev" class="anchor"></a><code><span class="keyword">val</span> writev : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <span>Cstruct.t list</span> <span>&#45;&gt;</span> <span><span><span>(unit, <a href="index.html#type-write_error">write_error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt></dl></details></div></div></div><dl><dt class="spec value" id="val-dst"><a href="#val-dst" class="anchor"></a><code><span class="keyword">val</span> dst : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <a href="index.html#type-ipaddr">ipaddr</a> * int</code></dt><dd><p>Get the destination IPv4 address and destination port that a flow is currently connected to.</p></dd></dl><dl><dt class="spec value" id="val-write_nodelay"><a href="#val-write_nodelay" class="anchor"></a><code><span class="keyword">val</span> write_nodelay : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> Cstruct.t <span>&#45;&gt;</span> <span><span><span>(unit, <a href="index.html#type-write_error">write_error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>write_nodelay flow buffer</code> writes the contents of <code>buffer</code> to the flow. The thread blocks until all data has been successfully transmitted to the remote endpoint. Buffering within the layer is minimized in this mode. Note that this API will change in a future revision to be a per-flow attribute instead of a separately exposed function.</p></dd></dl><dl><dt class="spec value" id="val-writev_nodelay"><a href="#val-writev_nodelay" class="anchor"></a><code><span class="keyword">val</span> writev_nodelay : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <span>Cstruct.t list</span> <span>&#45;&gt;</span> <span><span><span>(unit, <a href="index.html#type-write_error">write_error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>writev_nodelay flow buffers</code> writes the contents of <code>buffers</code> to the flow. The thread blocks until all data has been successfully transmitted to the remote endpoint. Buffering within the layer is minimized in this mode. Note that this API will change in a future revision to be a per-flow attribute instead of a separately exposed function.</p></dd></dl><dl><dt class="spec value" id="val-create_connection"><a href="#val-create_connection" class="anchor"></a><code><span class="keyword">val</span> create_connection : <span>?&#8288;keepalive:<a href="../Keepalive/index.html#type-t">Keepalive.t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>(<a href="index.html#type-ipaddr">ipaddr</a> * int)</span> <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#type-flow">flow</a>, <a href="index.html#type-error">error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>create_connection ~keepalive t (addr,port)</code> opens a TCPv4 connection to the specified endpoint.</p><p>If the optional argument <code>?keepalive</code> is provided then TCP keep-alive messages will be sent to the server when the connection is idle. If no responses are received then eventually the connection will be disconnected: <code>read</code> will return <code>Ok `Eof</code> and write will return <code>Error `Closed</code></p></dd></dl><dl><dt class="spec type" id="type-listener"><a href="#type-listener" class="anchor"></a><code><span class="keyword">type</span> listener</code><code> = </code><code>{</code><table class="record"><tr id="type-listener.process" class="anchored"><td class="def field"><a href="#type-listener.process" class="anchor"></a><code>process : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span>;</code></td><td class="doc"><p>process a connected flow</p></td></tr><tr id="type-listener.keepalive" class="anchored"><td class="def field"><a href="#type-listener.keepalive" class="anchor"></a><code>keepalive : <span><a href="../Keepalive/index.html#type-t">Keepalive.t</a> option</span>;</code></td><td class="doc"><p>optional TCP keepalive configuration</p></td></tr></table><code>}</code></dt><dd><p>A TCP listener on a particular port</p></dd></dl><dl><dt class="spec value" id="val-input"><a href="#val-input" class="anchor"></a><code><span class="keyword">val</span> input : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>listeners:<span>(int <span>&#45;&gt;</span> <span><a href="index.html#type-listener">listener</a> option</span>)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-ipinput">ipinput</a></code></dt><dd><p><code>input t listeners</code> returns an input function continuation to be passed to the underlying <a href="../module-type-IP/index.html"><code>IP</code></a> layer.</p><p>When the layer receives a TCP SYN (i.e. a connection request) to a particular <code>port</code>, it will evaluate <code>listeners port</code>:</p><ul><li>If <code>listeners port</code> is <code>None</code>, the input function will return an RST to refuse the connection.</li><li>If <code>listeners port</code> is <code>Some listener</code> then the connection will be accepted and the resulting flow will be processed by <code>listener.process</code>. If <code>listener.keepalive</code> is <code>Some configuration</code> then the TCP keep-alive <code>configuration</code> will be applied before calling <code>listener.process</code>.</li></ul></dd></dl></div></body></html>